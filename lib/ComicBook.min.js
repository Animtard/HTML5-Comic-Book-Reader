var Pixastic=function(){function d(a,g,o){a.addEventListener?a.addEventListener(g,o,!1):a.attachEvent&&a.attachEvent("on"+g,o)}function b(a){var g=!1,o=function(){g||(g=!0,a())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"><\/script>');var c=document.getElementById("__onload_ie_pixastic__");c.onreadystatechange=function(){c.readyState=="complete"&&(c.parentNode.removeChild(c),o())};document.addEventListener&&document.addEventListener("DOMContentLoaded",o,!1);d(window,"load",
o)}function k(){for(var a=e("pixastic",null,"img"),g=e("pixastic",null,"canvas"),o=a.concat(g),c=0;c<o.length;c++)(function(){for(var a=o[c],f=[],g=a.className.split(" "),b=0;b<g.length;b++){var e=g[b];e.substring(0,9)=="pixastic-"&&(e=e.substring(9),e!=""&&f.push(e))}if(f.length)if(a.tagName.toLowerCase()=="img")if(g=new Image,g.src=a.src,g.complete)for(g=0;g<f.length;g++)(b=Pixastic.applyAction(a,a,f[g],null))&&(a=b);else g.onload=function(){for(var c=0;c<f.length;c++){var g=Pixastic.applyAction(a,
a,f[c],null);g&&(a=g)}};else setTimeout(function(){for(var c=0;c<f.length;c++){var g=Pixastic.applyAction(a,a,f[c],null);g&&(a=g)}},1)})()}function e(a,g,b){var c=[];g==null&&(g=document);b==null&&(b="*");g=g.getElementsByTagName(b);b=g.length;a=RegExp("(^|\\s)"+a+"(\\s|$)");for(i=0,j=0;i<b;i++)a.test(g[i].className)&&(c[j]=g[i],j++);return c}function q(a,g){if(Pixastic.debug)try{switch(g){case "warn":console.warn("Pixastic:",a);break;case "error":console.error("Pixastic:",a);break;default:console.log("Pixastic:",
a)}}catch(b){}}typeof pixastic_parseonload!="undefined"&&pixastic_parseonload&&b(k);var n=function(){var a=document.createElement("canvas"),g=!1;try{g=!!(typeof a.getContext=="function"&&a.getContext("2d"))}catch(b){}return function(){return g}}(),h=function(){var a=document.createElement("canvas"),g=!1,b;try{if(typeof a.getContext=="function"&&(b=a.getContext("2d")))g=typeof b.getImageData=="function"}catch(c){}return function(){return g}}(),l=function(){var a=!1,g=document.createElement("canvas");
if(n()&&h()){g.width=g.height=1;g=g.getContext("2d");g.fillStyle="rgb(255,0,0)";g.fillRect(0,0,1,1);var b=document.createElement("canvas");b.width=b.height=1;var c=b.getContext("2d");c.fillStyle="rgb(0,0,255)";c.fillRect(0,0,1,1);g.globalAlpha=0.5;g.drawImage(b,0,0);a=g.getImageData(0,0,1,1).data[2]!=255}return function(){return a}}();return{parseOnLoad:!1,debug:!1,applyAction:function(a,b,e,c){var c=c||{},d=a.tagName.toLowerCase()=="canvas";if(d&&Pixastic.Client.isIE())return Pixastic.debug&&q("Tried to process a canvas element but browser is IE."),
!1;var f,k,n=!1;Pixastic.Client.hasCanvas()&&(n=!!c.resultCanvas,f=c.resultCanvas||document.createElement("canvas"),k=f.getContext("2d"));var h=a.offsetWidth,l=a.offsetHeight;if(d)h=a.width,l=a.height;if(h==0||l==0)if(a.parentNode==null){var p=a.style.position,m=a.style.left;a.style.position="absolute";a.style.left="-9999px";document.body.appendChild(a);h=a.offsetWidth;l=a.offsetHeight;document.body.removeChild(a);a.style.position=p;a.style.left=m}else{Pixastic.debug&&q("Image has 0 width and/or height.");
return}if(e.indexOf("(")>-1&&(p=e,e=p.substr(0,p.indexOf("(")),p=p.match(/\((.*?)\)/),p[1])){p=p[1].split(";");for(m=0;m<p.length;m++)if(thisArg=p[m].split("="),thisArg.length==2)if(thisArg[0]=="rect"){var u=thisArg[1].split(",");c[thisArg[0]]={left:parseInt(u[0],10)||0,top:parseInt(u[1],10)||0,width:parseInt(u[2],10)||0,height:parseInt(u[3],10)||0}}else c[thisArg[0]]=thisArg[1]}c.rect?(c.rect.left=Math.round(c.rect.left),c.rect.top=Math.round(c.rect.top),c.rect.width=Math.round(c.rect.width),c.rect.height=
Math.round(c.rect.height)):c.rect={left:0,top:0,width:h,height:l};p=!1;Pixastic.Actions[e]&&typeof Pixastic.Actions[e].process=="function"&&(p=!0);if(!p)return Pixastic.debug&&q('Invalid action "'+e+'". Maybe file not included?'),!1;if(!Pixastic.Actions[e].checkSupport())return Pixastic.debug&&q('Action "'+e+'" not supported by this browser.'),!1;if(Pixastic.Client.hasCanvas()){if(f!==a)f.width=h,f.height=l;if(!n)f.style.width=h+"px",f.style.height=l+"px";k.drawImage(b,0,0,h,l);a.__pixastic_org_image?
(f.__pixastic_org_image=a.__pixastic_org_image,f.__pixastic_org_width=a.__pixastic_org_width,f.__pixastic_org_height=a.__pixastic_org_height):(f.__pixastic_org_image=a,f.__pixastic_org_width=h,f.__pixastic_org_height=l)}else if(Pixastic.Client.isIE()&&typeof a.__pixastic_org_style=="undefined")a.__pixastic_org_style=a.style.cssText;b={image:a,canvas:f,width:h,height:l,useData:!0,options:c};if(!Pixastic.Actions[e].process(b))return!1;if(Pixastic.Client.hasCanvas()){b.useData&&Pixastic.Client.hasCanvasImageData()&&
(f.getContext("2d").putImageData(b.canvasData,c.rect.left,c.rect.top),f.getContext("2d").fillRect(0,0,0,0));if(!c.leaveDOM){f.title=a.title;f.imgsrc=a.imgsrc;if(!d)f.alt=a.alt;if(!d)f.imgsrc=a.src;f.className=a.className;f.style.cssText=a.style.cssText;f.name=a.name;f.tabIndex=a.tabIndex;f.id=a.id;a.parentNode&&a.parentNode.replaceChild&&a.parentNode.replaceChild(f,a)}return c.resultCanvas=f}return a},prepareData:function(a,b){var e=a.canvas.getContext("2d"),c=a.options.rect,e=e.getImageData(c.left,
c.top,c.width,c.height),c=e.data;if(!b)a.canvasData=e;return c},process:function(a,b,e,c){if(a.tagName.toLowerCase()=="img"){var d=new Image;d.src=a.src;if(d.complete){var f=Pixastic.applyAction(a,d,b,e);c&&c(f);return f}else d.onload=function(){var f=Pixastic.applyAction(a,d,b,e);c&&c(f)}}if(a.tagName.toLowerCase()=="canvas")return f=Pixastic.applyAction(a,a,b,e),c&&c(f),f},revert:function(a){if(Pixastic.Client.hasCanvas()){if(a.tagName.toLowerCase()=="canvas"&&a.__pixastic_org_image)return a.width=
a.__pixastic_org_width,a.height=a.__pixastic_org_height,a.getContext("2d").drawImage(a.__pixastic_org_image,0,0),a.parentNode&&a.parentNode.replaceChild&&a.parentNode.replaceChild(a.__pixastic_org_image,a),a}else if(Pixastic.Client.isIE()&&typeof a.__pixastic_org_style!="undefined")a.style.cssText=a.__pixastic_org_style},Client:{hasCanvas:n,hasCanvasImageData:h,hasGlobalAlpha:l,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();
Pixastic.Actions.brightness={process:function(d){var b=parseInt(d.options.brightness,10)||0,k=parseFloat(d.options.contrast)||0,e=!!(d.options.legacy&&d.options.legacy!="false");if(e)b=Math.min(150,Math.max(-150,b));else var q=1+Math.min(150,Math.max(-150,b))/150;k=Math.max(0,k+1);if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(d),d=d.options.rect,d=d.width*d.height,h=d*4,l,a;k!=1?e?(e=k,b=(b-128)*k+128):(e=q*k,b=-k*128+128):e?e=1:(e=q,b=0);for(var g,o,c;d--;)n[h]=(g=n[h-=4]*e+
b)>255?255:g<0?0:g,n[l]=(o=n[l=h+1]*e+b)>255?255:o<0?0:o,n[a]=(c=n[a=h+2]*e+b)>255?255:c<0?0:c;return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};
Pixastic.Actions.desaturate={process:function(d){var b=!!(d.options.average&&d.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var k=Pixastic.prepareData(d),d=d.options.rect,d=d.width*d.height,e=d*4,q,n;if(b)for(;d--;)k[e-=4]=k[q=e+1]=k[n=e+2]=(k[e]+k[q]+k[n])/3;else for(;d--;)k[e-=4]=k[q=e+1]=k[n=e+2]=k[e]*0.3+k[q]*0.59+k[n]*0.11;return!0}else if(Pixastic.Client.isIE())return d.image.style.filter+=" gray",!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||
Pixastic.Client.isIE()}};
Pixastic.Actions.sharpen={process:function(d){var b=0;typeof d.options.amount!="undefined"&&(b=parseFloat(d.options.amount)||0);b<0&&(b=0);b>1&&(b=1);if(Pixastic.Client.hasCanvasImageData()){for(var k=Pixastic.prepareData(d),e=Pixastic.prepareData(d,!0),q=15,b=1+3*b,n=[[0,-b,0],[-b,q,-b],[0,-b,0]],h=0,l=0;l<3;l++)for(var a=0;a<3;a++)h+=n[l][a];h=1/h;n=d.options.rect;d=n.width;n=n.height;q*=h;b*=h;h=d*4;l=n;do{var a=(l-1)*h,g=(l==1?0:l-2)*h,o=(l==n?l-1:l)*h,c=d;do{var r=a+(c*4-4),f=g+(c==1?0:c-2)*
4,s=o+(c==d?c-1:c)*4,t=(-e[f]-e[r-4]-e[r+4]-e[s])*b+e[r]*q,v=(-e[f+1]-e[r-3]-e[r+5]-e[s+1])*b+e[r+1]*q,f=(-e[f+2]-e[r-2]-e[r+6]-e[s+2])*b+e[r+2]*q;t<0&&(t=0);v<0&&(v=0);f<0&&(f=0);t>255&&(t=255);v>255&&(v=255);f>255&&(f=255);k[r]=t;k[r+1]=v;k[r+2]=f}while(--c)}while(--l);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};function merge(d,b){var k;typeof b==="undefined"&&(b={});for(k in d)d.hasOwnProperty(k)&&!(k in b)&&(b[k]=d[k]);return b}
var ComicBookException={INVALID_PAGE:"invalid page",INVALID_PAGE_TYPE:"invalid page type",UNDEFINED_CONTROL:"undefined control",INVALID_ZOOM_MODE:"invalid zoom mode",INVALID_NAVIGATION_EVENT:"invalid navigation event"};
function ComicBook(d,b,k){function e(){var a=window.innerHeight+1;p===!1&&(p=$(document.createElement("div")).attr("id","cb-width-shiv").css({width:"100%",position:"absolute",top:0,zIndex:"-1000"}),$("body").append(p));p.height(a);return p.innerWidth()}function q(){var a=n();a!==m&&f.indexOf(a)>-1&&(m=a,ComicBook.prototype.draw())}function n(){var a=parseInt(location.hash.substring(1),10)-1||0;if(a<0)a=location.hash=0;return a}function h(){c=document.getElementById(l);r=c.getContext("2d");v===!1&&
(ComicBook.prototype.renderControls(),v=!0);c.addEventListener("click",ComicBook.prototype.navigation,!1);window.addEventListener("keydown",ComicBook.prototype.navigation,!1);window.addEventListener("hashchange",q,!1)}var l=d;this.srcs=b;var a=merge({displayMode:"double",zoomMode:"fitWidth",manga:!1,enhance:{},keyboard:{next:78,previous:80,toolbar:84,toggleLayout:76}},k),g=b.length,o=[],c,r,f=[],s=1,t=!1,v=!1,w=!1,p=!1,d=n(),m=d<b.length?d:0;ComicBook.prototype.control={status:$(document.createElement("p")).attr("id",
"cb-status").addClass("cb-control cb-always-on"),toolbar:$(document.createElement("div")).attr("id","cb-toolbar").addClass("cb-control").append($(document.createElement("button")).attr("title","close the toolbar").addClass("cb-close").click(function(){ComicBook.prototype.toggleToolbar()})).append($(document.createElement("button")).attr("title","switch between dual and single page modes").addClass("cb-layout "+a.displayMode).click(function(){ComicBook.prototype.toggleLayout()})).append($(document.createElement("button")).attr("title",
"tweak the page colors").addClass("cb-color cb-menu-button").click(function(){ComicBook.prototype.toggleControl("color")})).append($(document.createElement("button")).attr("title","zoom out").addClass("cb-zoom-out").click(function(){ComicBook.prototype.zoom(s-0.1)})).append($(document.createElement("button")).attr("title","zoom in").addClass("cb-zoom-in").click(function(){ComicBook.prototype.zoom(s+0.1)})).append($(document.createElement("button")).attr("title","fit to page width").addClass("cb-fit-width").click(function(){a.zoomMode=
"fitWidth";ComicBook.prototype.drawPage()})).append($(document.createElement("p")).attr("id","cb-comic-info").append("<span id='cb-current-page'></span> / "+b.length)),color:$(document.createElement("div")).attr("id","cb-color").addClass("cb-control").append("<label for='cb-sharpen'>Brightness</label>").append($("<div id='cb-brightness' class='cb-option'></div>").slider({value:0,step:10,min:-1E3,max:1E3,change:function(a,b){ComicBook.prototype.enhance.brightness({brightness:b.value})}})).append("<label for='cb-sharpen'>Contrast</label>").append($("<div id='cb-contrast' class='cb-option'></div>").slider({value:0,
step:0.0010,min:0,max:1,change:function(a,b){ComicBook.prototype.enhance.brightness({contrast:b.value})}})).append("<label for='cb-sharpen'>Sharpen</label>").append($("<div id='cb-sharpen' class='cb-option'></div>").slider({value:0,step:0.0010,min:0,max:1,change:function(a,b){ComicBook.prototype.enhance.sharpen({amount:b.value})}})).append($(document.createElement("div")).addClass("cb-option").append("<input type='checkbox' id='cb-desaturate' /> <label for='cb-desaturate'>Desaturate</label>").append("<button id='cb-reset'>reset</button>")),
navigation:{left:$(document.createElement("div")).addClass("cb-control cb-navigate cb-always-on left").click(function(){ComicBook.prototype.drawPrevPage()}),right:$(document.createElement("div")).addClass("cb-control cb-navigate cb-always-on right").click(function(){ComicBook.prototype.drawNextPage()})},loadingOverlay:$(document.createElement("div")).attr("id","cb-loading-overlay").addClass("cb-control")};ComicBook.prototype.renderControls=function(){$(c).before(this.getControl("loadingOverlay")).before(this.getControl("status")).after(this.getControl("toolbar").hide()).after(this.getControl("navigation").left).after(this.getControl("navigation").right).after(this.getControl("color").hide());
$(".cb-menu-button").click(function(){$(this).toggleClass("active")});$("#cb-desaturate").click(function(){$(this).is(":checked")?ComicBook.prototype.enhance.desaturate():ComicBook.prototype.enhance.resaturate()});$("#cb-reset").click(function(){$("#cb-brightness").slider("value",0);$("#cb-contrast").slider("value",0);$("#cb-saturation").slider("value",0);$("#cb-sharpen").slider("value",0);$("#cb-desaturate").attr("checked",!1);ComicBook.prototype.enhance.reset()})};ComicBook.prototype.getControl=
function(a){if(typeof this.control[a]==="undefined")throw ComicBookException.UNDEFINED_CONTROL+" "+a;return this.control[a]};ComicBook.prototype.showControl=function(a){this.getControl(a).show().addClass("open")};ComicBook.prototype.hideControl=function(a){this.getControl(a).removeClass("open").hide()};ComicBook.prototype.toggleControl=function(a){this.getControl(a).toggle().toggleClass("open")};ComicBook.prototype.toggleToolbar=function(){$("#cb-toolbar").is(":visible")?$(".cb-control").not(".cb-always-on").hide():
$("#cb-toolbar, .cb-control.open").show()};ComicBook.prototype.toggleLayout=function(){a.displayMode==="double"?($("#cb-toolbar .cb-layout").removeClass("double"),a.displayMode="single"):($("#cb-toolbar .cb-layout").removeClass("single"),a.displayMode="double");$("#cb-toolbar .cb-layout").addClass(a.displayMode);ComicBook.prototype.drawPage()};ComicBook.prototype.getPage=function(a){if(a<0||a>b.length-1)throw ComicBookException.INVALID_PAGE+" "+a;if(typeof o[a]==="object")return o[a];else w=a,this.showControl("loadingOverlay")};
ComicBook.prototype.draw=function(){h();$(".cb-control.cb-navigate").outerHeight(window.innerHeight);$("#cb-toolbar").outerWidth(e());$("#cb-loading-overlay").outerWidth(e()).height(window.innerHeight);o.length!==g?this.preload():this.drawPage()};ComicBook.prototype.zoom=function(b){a.zoomMode="manual";s=b;typeof this.getPage(m)==="object"&&this.drawPage()};ComicBook.prototype.preload=function(){function c(e){var u=new Image;u.src=b[e];u.onload=function(){o[e]=this;f.push(e);var c=Math.floor(f.length/
g*100);$("#cb-status").text("loading "+c+"%");var u=a.displayMode==="double"&&m<b.length-1?1:0;if(d===!1&&$.inArray(m+u,f)!==-1||typeof w==="number"&&$.inArray(w,f)!==-1)typeof w==="number"&&(m=w-1,w=!1),ComicBook.prototype.drawPage(),ComicBook.prototype.hideControl("loadingOverlay"),d=!0;c===100&&$("#cb-status").delay(500).fadeOut()}}var e=m,d=!1;this.showControl("loadingOverlay");(function(a,b){for(var e=1,f=a,d=a-1;f<=b;)e>3&&d>-1?(c(d),d--,e=0):(c(f),f++),e++;for(;d>-1;)c(d),d--})(e,b.length-
1)};ComicBook.prototype.pageLoaded=function(a){return typeof f[a-1]!=="undefined"};ComicBook.prototype.drawPage=function(d){if(typeof d==="number"&&d<b.length&&d>0&&(m=d-1,!this.pageLoaded(d))){this.showControl("loadingOverlay");return}m<0&&(m=0);var f,g=0,k=0,h=ComicBook.prototype.getPage(m),d=!1;a.displayMode==="double"&&m<b.length-1&&(d=ComicBook.prototype.getPage(m+1));if(typeof h!=="object")throw ComicBookException.INVALID_PAGE_TYPE+" "+typeof h;var l=h.width;c.width=0;c.height=0;if(t=typeof d===
"object"&&(h.width>h.height||d.width>d.height)&&a.displayMode==="double")a.displayMode="single";a.displayMode==="double"&&(l+=typeof d==="object"?d.width:l);switch(a.zoomMode){case "manual":document.body.style.overflowX="auto";f=a.displayMode==="double"?s*2:s;break;case "fitWidth":document.body.style.overflowX="hidden";s=f=e()>l?(e()-l)/e()+1:e()/l;break;default:throw ComicBookException.INVALID_ZOOM_MODE+" "+a.zoomMode;}var l=h.width*f,o=h.height*f;f=a.zoomMode==="manual"?h.width*s:l;var p=a.zoomMode===
"manual"?h.height*s:o,o=p;c.width=l<e()?e():l;c.height=o<window.innerHeight?window.innerHeight:o;l<e()&&a.zoomMode==="manual"&&(g=(e()-f)/2,a.displayMode==="double"&&(g-=f/2));o<window.innerHeight&&a.zoomMode==="manual"&&(k=(window.innerHeight-p)/2);a.manga&&a.displayMode==="double"&&typeof d==="object"&&(l=h,h=d,d=l);r.drawImage(h,g,k,f,p);a.displayMode==="double"&&typeof d==="object"&&r.drawImage(d,f+g,k,f,p);$.each(a.enhance,function(a,b){ComicBook.prototype.enhance[a](b)});g=a.displayMode==="double"&&
m+2<=b.length?m+1+"-"+(m+2):m+1;$("#cb-current-page").text(g);if(t)a.displayMode="double";$("button.cb-fit-width").attr("disabled",a.zoomMode==="fitWidth");$(".cb-navigate").show();m===0&&($(".cb-navigate.left").hide(),$(".cb-navigate.right").show());if(m===b.length-1||typeof d==="object"&&m===b.length-2)$(".cb-navigate.left").show(),$(".cb-navigate.right").hide();typeof a.afterDrawPage==="function"&&a.afterDrawPage(m+1);if(n()!==m)location.hash=m+1;window.scroll(0,0)};ComicBook.prototype.drawNextPage=
function(){var b;try{b=this.getPage(m+1)}catch(c){}if(!b)return!1;if(m+1<o.length){m+=a.displayMode==="single"||t?1:2;try{this.drawPage()}catch(d){}}};ComicBook.prototype.drawPrevPage=function(){var b;try{b=this.getPage(m-1)}catch(c){}if(!b)return!1;t=b.width>b.height;m>0&&(m-=a.displayMode==="single"||t?1:2,this.drawPage())};ComicBook.prototype.enhance={reset:function(b){b?delete a.enhance[b]:a.enhance={};ComicBook.prototype.drawPage()},brightness:function(b,d){d!==!1&&this.reset("brightness");var e=
merge({brightness:0,contrast:0},b);a.enhance.brightness=e;Pixastic.process(c,"brightness",{brightness:e.brightness,contrast:e.contrast,legacy:!0});h()},desaturate:function(){a.enhance.desaturate={};Pixastic.process(c,"desaturate",{average:!1});h()},resaturate:function(){delete a.enhance.desaturate;ComicBook.prototype.drawPage()},sharpen:function(b){this.desharpen();b=merge({amount:0},b);a.enhance.sharpen=b;Pixastic.process(c,"sharpen",{amount:b.amount});h()},desharpen:function(){delete a.enhance.sharpen;
ComicBook.prototype.drawPage()}};ComicBook.prototype.navigation=function(b){if($("#cb-loading-overlay").is(":visible"))return!1;var c=!1;switch(b.type){case "click":ComicBook.prototype.toggleToolbar();break;case "keydown":b.keyCode===a.keyboard.previous&&(c="left");b.keyCode===a.keyboard.next&&(c="right");b.keyCode===a.keyboard.toolbar&&ComicBook.prototype.toggleToolbar();b.keyCode===a.keyboard.toggleLayout&&ComicBook.prototype.toggleLayout();break;default:throw ComicBookException.INVALID_NAVIGATION_EVENT+
" "+b.type;}if(c)return b.stopPropagation(),a.manga?(c==="left"&&ComicBook.prototype.drawNextPage(),c==="right"&&ComicBook.prototype.drawPrevPage()):(c==="left"&&ComicBook.prototype.drawPrevPage(),c==="right"&&ComicBook.prototype.drawNextPage()),!1}};
