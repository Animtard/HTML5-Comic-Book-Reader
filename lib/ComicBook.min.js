function merge(j,g){var k;typeof g==="undefined"&&(g={});for(k in j)j.hasOwnProperty(k)&&!(k in g)&&(g[k]=j[k]);return g}function ComicBookException(j,g){this.type=j;this.object=g;this.INVALID_PAGE="invalid page";this.INVALID_PAGE_TYPE="invalid page type";this.UNDEFINED_CONTROL="undefined control";this.INVALID_ZOOM_MODE="invalid zoom mode";this.INVALID_NAVIGATION_EVENT="invalid navigation event"}
function ComicBook(j,g,k){function m(){var a=window.innerHeight+1;o===!1&&(o=$(document.createElement("div")).attr("id","cb-width-shiv").css({width:"100%",position:"absolute",top:0,zIndex:"-1000"}),$("body").append(o));o.height(a);return o.innerWidth()}function w(){var a=parseInt(location.hash.substring(1),10)-1||0;a!==d&&h.indexOf(a)>-1&&(d=a,ComicBook.prototype.draw())}function s(){i=document.getElementById(x);t=i.getContext("2d");v===!1&&(ComicBook.prototype.renderControls(),v=!0);i.addEventListener("click",
ComicBook.prototype.navigation,!1);window.addEventListener("keydown",ComicBook.prototype.navigation,!1);window.addEventListener("hashchange",w,!1)}var x=j;this.srcs=g;var b=merge({displayMode:"double",zoomMode:"fitWidth",manga:!1,enhance:{},keyboard:{next:78,previous:80,toolbar:84,toggleLayout:76}},k),e=g.length,p=[],i,t,u=1,h=[],n=1,q=!1,v=!1,r=!1,o=!1,d=parseInt(location.hash.substring(1),10)-1||0;ComicBook.prototype.control={status:$(document.createElement("p")).attr("id","cb-status").addClass("cb-control cb-always-on"),
toolbar:$(document.createElement("div")).hide().attr("id","cb-toolbar").addClass("cb-control").append($(document.createElement("button")).attr("title","close the toolbar").addClass("cb-close").click(function(){ComicBook.prototype.toggleToolbar()})).append($(document.createElement("button")).attr("title","switch between dual and single page modes").addClass("cb-layout "+b.displayMode).click(function(){ComicBook.prototype.toggleLayout()})).append($(document.createElement("button")).attr("title","tweak the page colors").addClass("cb-color cb-menu-button").click(function(){ComicBook.prototype.toggleControl("color")})).append($(document.createElement("button")).attr("title",
"zoom out").addClass("cb-zoom-out").click(function(){ComicBook.prototype.zoom(n-0.1)})).append($(document.createElement("button")).attr("title","zoom in").addClass("cb-zoom-in").click(function(){ComicBook.prototype.zoom(n+0.1)})).append($(document.createElement("button")).attr("title","fit to page width").addClass("cb-fit-width").click(function(){b.zoomMode="fitWidth";ComicBook.prototype.drawPage()})).append($(document.createElement("p")).attr("id","cb-comic-info").append("<span id='cb-current-page'></span> / "+
g.length)),color:$(document.createElement("div")).attr("id","cb-color").addClass("cb-control").append("<label for='cb-sharpen'>Brightness</label>").append($("<div id='cb-brightness' class='cb-option'></div>").slider({value:0,step:10,min:-1E3,max:1E3,slide:function(a,b){ComicBook.prototype.enhance.brightness({brightness:b.value})}})).append("<label for='cb-sharpen'>Contrast</label>").append($("<div id='cb-contrast' class='cb-option'></div>").slider({value:0,step:0.1,min:0,max:1,slide:function(a,b){ComicBook.prototype.enhance.brightness({contrast:b.value})}})).append("<label for='cb-sharpen'>Sharpen</label>").append($("<div id='cb-sharpen' class='cb-option'></div>").slider({value:0,
step:0.1,min:0,max:1,slide:function(a,b){ComicBook.prototype.enhance.sharpen({amount:b.value})}})).append($(document.createElement("div")).addClass("cb-option").append("<input type='checkbox' id='cb-desaturate' /> <label for='cb-desaturate'>Desaturate</label>").append("<button id='cb-reset'>reset</button>")),navigation:{left:$(document.createElement("div")).addClass("cb-control cb-navigate cb-always-on left").click(function(){ComicBook.prototype.drawPrevPage()}),right:$(document.createElement("div")).addClass("cb-control cb-navigate cb-always-on right").click(function(){ComicBook.prototype.drawNextPage()})},
loadingOverlay:$(document.createElement("div")).attr("id","cb-loading-overlay").addClass("cb-control")};ComicBook.prototype.renderControls=function(){$(i).before(this.getControl("loadingOverlay")).before(this.getControl("status")).after(this.getControl("toolbar")).after(this.getControl("navigation").left).after(this.getControl("navigation").right).after(this.getControl("color").hide());$(".cb-menu-button").click(function(){$(this).toggleClass("active")});$("#cb-desaturate").click(function(){$(this).is(":checked")?
ComicBook.prototype.enhance.desaturate():ComicBook.prototype.enhance.resaturate()});$("#cb-reset").click(function(){$("#cb-brightness").slider("value",0);$("#cb-contrast").slider("value",0);$("#cb-saturation").slider("value",0);$("#cb-sharpen").slider("value",0);$("#cb-desaturate").attr("checked",!1);ComicBook.prototype.enhance.reset()})};ComicBook.prototype.getControl=function(a){if(typeof this.control[a]==="undefined")throw new ComicBookException(ComicBookException.UNDEFINED_CONTROL,a);return this.control[a]};
ComicBook.prototype.showControl=function(a){this.getControl(a).show().addClass("open")};ComicBook.prototype.hideControl=function(a){this.getControl(a).removeClass("open").hide()};ComicBook.prototype.toggleControl=function(a){this.getControl(a).toggle().toggleClass("open")};ComicBook.prototype.toggleToolbar=function(){$("#cb-toolbar").is(":visible")?$(".cb-control").not(".cb-always-on").hide():$("#cb-toolbar, .cb-control.open").show()};ComicBook.prototype.toggleLayout=function(){b.displayMode==="double"?
($("#cb-toolbar .cb-layout").removeClass("double"),b.displayMode="single"):($("#cb-toolbar .cb-layout").removeClass("single"),b.displayMode="double");$("#cb-toolbar .cb-layout").addClass(b.displayMode);ComicBook.prototype.drawPage()};ComicBook.prototype.getPage=function(a){if(a<0||a>g.length)throw new ComicBookException(ComicBookException.INVALID_PAGE,a);if(typeof p[a]==="object")return p[a];else r=a,this.showControl("loadingOverlay")};ComicBook.prototype.draw=function(){s();$(".cb-control.cb-navigate").outerHeight(window.innerHeight);
$("#cb-toolbar").outerWidth(m());$("#cb-loading-overlay").outerWidth(m()).height(window.innerHeight);p.length!==e?this.preload():this.drawPage()};ComicBook.prototype.zoom=function(a){b.zoomMode="manual";n=a;typeof this.getPage(d)==="object"&&this.drawPage()};ComicBook.prototype.preload=function(){function a(c){var i=new Image,f;$("#cb-status").text("loading page "+(c+1)+" of "+e);i.src=g[c];i.onload=function(){p[c]=this;h.push(c);c===e-1&&h.length!==e&&(c=-1);h.length<e&&(c++,a(c));f=b.displayMode===
"double"?1:0;if(h[h.length-1]===d+u+f||h[h.length-1]===r)typeof r==="number"&&(d=r-1,r=!1),ComicBook.prototype.drawPage(),ComicBook.prototype.hideControl("loadingOverlay");h.length===e&&ComicBook.prototype.hideControl("status")}}this.showControl("loadingOverlay");e<u&&(u=e);a(d)};ComicBook.prototype.pageLoaded=function(a){return typeof h[a-1]!=="undefined"};ComicBook.prototype.drawPage=function(a){if(typeof a==="number"&&a<g.length&&(d=a-1,!this.pageLoaded(a))){this.showControl("loadingOverlay");
return}var c,h=a=0,f=ComicBook.prototype.getPage(d),e=ComicBook.prototype.getPage(d+1);if(typeof f!=="object")throw new ComicBookException(ComicBookException.INVALID_PAGE_TYPE,typeof f);var l=f.width;i.width=0;i.height=0;if(q=(f.width>f.height||e.width>e.height)&&b.displayMode==="double")b.displayMode="single";b.displayMode==="double"&&(l+=typeof e==="object"?e.width:l);switch(b.zoomMode){case "manual":document.body.style.overflowX="auto";c=b.displayMode==="double"?n*2:n;break;case "fitWidth":document.body.style.overflowX=
"hidden";n=c=m()>l?(m()-l)/m()+1:m()/l;break;default:throw new ComicBookException(ComicBookException.INVALID_ZOOM_MODE,b.zoomMode);}var l=f.width*c,j=f.height*c;c=b.zoomMode==="manual"?f.width*n:l;var k=b.zoomMode==="manual"?f.height*n:j,j=k;i.width=l<m()?m():l;i.height=j<window.innerHeight?window.innerHeight:j;l<m()&&b.zoomMode==="manual"&&(a=(m()-c)/2,b.displayMode==="double"&&(a-=c/2));j<window.innerHeight&&b.zoomMode==="manual"&&(h=(window.innerHeight-k)/2);b.manga&&b.displayMode==="double"&&
(l=f,f=e,e=l);t.drawImage(f,a,h,c,k);b.displayMode==="double"&&typeof e==="object"&&t.drawImage(e,c+a,h,c,k);$.each(b.enhance,function(a,b){ComicBook.prototype.enhance[a](b)});a=b.displayMode==="double"?d+1+"-"+(d+2):d+1;$("#cb-current-page").text(a);if(q)b.displayMode="double";typeof b.afterDrawPage==="function"&&b.afterDrawPage(d+1);if((parseInt(location.hash.substring(1),10)-1||0)!==d)location.hash=d+1;window.scroll(0,0)};ComicBook.prototype.drawNextPage=function(){if(!this.getPage(d+1))return!1;
d+1<p.length&&(d+=b.displayMode==="single"||q?1:2,this.drawPage())};ComicBook.prototype.drawPrevPage=function(){var a=this.getPage(d-1);if(!a)return!1;q=a.width>a.height;d>0&&(d-=b.displayMode==="single"||q?1:2,this.drawPage())};ComicBook.prototype.enhance={reset:function(a){a?delete b.enhance[a]:b.enhance={};ComicBook.prototype.drawPage()},brightness:function(a,c){c!==!1&&this.reset("brightness");var d=merge({brightness:0,contrast:0},a);b.enhance.brightness=d;Pixastic.process(i,"brightness",{brightness:d.brightness,
contrast:d.contrast,legacy:!0});s()},desaturate:function(){b.enhance.desaturate={};Pixastic.process(i,"desaturate",{average:!1});s()},resaturate:function(){delete b.enhance.desaturate;ComicBook.prototype.drawPage()},sharpen:function(a){this.desharpen();a=merge({amount:0},a);b.enhance.sharpen=a;Pixastic.process(i,"sharpen",{amount:a.amount});s()},desharpen:function(){delete b.enhance.sharpen;ComicBook.prototype.drawPage()}};ComicBook.prototype.navigation=function(a){if($("#cb-loading-overlay").is(":visible"))return!1;
var c=!1;switch(a.type){case "click":ComicBook.prototype.toggleToolbar();break;case "keydown":a.keyCode===b.keyboard.previous&&(c="left");a.keyCode===b.keyboard.next&&(c="right");a.keyCode===b.keyboard.toolbar&&ComicBook.prototype.toggleToolbar();a.keyCode===b.keyboard.toggleLayout&&ComicBook.prototype.toggleLayout();break;default:throw new ComicBookException(ComicBookException.INVALID_NAVIGATION_EVENT,a.type);}if(c)return a.stopPropagation(),b.manga?(c==="left"&&ComicBook.prototype.drawNextPage(),
c==="right"&&ComicBook.prototype.drawPrevPage()):(c==="left"&&ComicBook.prototype.drawPrevPage(),c==="right"&&ComicBook.prototype.drawNextPage()),!1}};
